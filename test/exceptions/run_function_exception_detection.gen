# Test for run_function exception interaction (Issue #141)
# This test demonstrates that when run_function is called from native functions
# and an exception occurs inside the executed function, the VM properly handles
# the exception and doesn't crash or leave the stack in an inconsistent state.

class TestError {}

class TestClass {
    __str__() {
        throw TestError();
    }
}

var obj = TestClass();

# This should cause run_function to detect the exception and return RuntimeError,
# which then causes print_native to return an error, leading to a clean exit
# instead of a crash.
print(obj); # should cause clean runtime error exit